const t='Cannot wrap "undefined" element',e="There is an existing calendar on current element",n='Function "calendarWrap" must return a valid HTML',a='Function "calendarRoot" must return a valid root element HTML',r='Function "calendarBodyRoot" must return a valid body root element HTML to render calendar correctly',s='Function "dayElement" must return a valid day element HTML',i='Function "monthElement" must return a valid month element HTML',o='Function "dateElement" must return a valid date element HTML',c='Please select a day between [0,6] where 0 = "Sunday" and 6 = "Saturday"',h='To use this feature set "rangeSelection" to true',d='To use this feature set "rangeSelection" to false',l="Swapping start date with end date as current end date is smaller than start date.",u='<div class="calendar-wrap"></div>',f='<div class="calendar-root"></div>',g='<div class="calendar-header">\n    This is a placeholder header. Use "calendarHeader()" method to customise calendar header\n</div>',p='<div class="calendar-body-root"></div>',w='<div class="calendar-footer">\n    This is a placeholder footer. Use "calendarFooter()" method to customise calendar footer\n</div>',m='<div class="calendar-day">{{day}}</div>',y='<button type="button" class="calendar-date">{{date}}</button>',D='<div class="calendar-month">{{month}}</div>',v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],S=["January","February","March","April","May","June","July","August","September","October","November","December"];function T(t){return t&&"object"==typeof t?JSON.stringify(t):t}function M(t){let e="";if("string"==typeof t)for(let n=0;n<t.length;n++)t.charCodeAt(n)>=65&&t.charCodeAt(n)<=90?e+=`-${t.charAt(n).toLowerCase()}`:e+=t.charAt(n);return e}class b{constructor(t,e){if(this.length=0,"string"==typeof(n=t)||n instanceof b||n instanceof Node||n instanceof NodeList||Array.isArray(n)){if("string"==typeof t){const n="<"===t.trim().charAt(0);if(e=e||n)if(n){const e=document.createElement("div");e.innerHTML=t,t=e.childNodes}else{const e=document.createDocumentFragment();e.appendChild(document.createTextNode(t)),t=[e]}else t=document.querySelectorAll(t)}t instanceof Node&&(t=[t]);for(let e=0;e<t.length;e++)[1,9,11].indexOf(t[e].nodeType)>-1&&(this[this.length++]=t[e])}var n}html(t){return void 0===t?this.map(t=>t.innerHTML).join(""):(null!==t&&this.each(e=>{e.innerHTML=t.toString()}),this)}outerHtml(){let t="";return this.each(e=>{t+=e.outerHTML+"\n"}),t}append(t){return this.each((e,n)=>{new b(t,"string"==typeof t).clone(0===n).each(t=>{e.appendChild(t)})}),this}prepend(t){const e=this.children().detach();this.append(t).append(e)}detach(){const t=document.createDocumentFragment();return this.each(e=>{t.appendChild(e)}),new b([t])}children(){const t=[];return this.each(e=>{t.push(...e.childNodes)}),new b(t)}filter(t){const e=new b;return"function"==typeof t&&this.each((n,a)=>{t.apply(n,[n,a])&&(e[e.length++]=n)}),e}clone(t){return t?this:new b(this.map(t=>t.cloneNode(!0)))}map(t){const e=[];return"function"==typeof t&&this.each((n,a)=>{e.push(t.apply(n,[n,a]))}),e}each(t){if("function"==typeof t)for(let e=0;e<this.length;e++)t.apply(this[e],[this[e],e]);return this}data(t,e){if(1===arguments.length){if("string"==typeof t)return function(t){switch(t){case"true":return!0;case"false":return!1;case"NaN":return NaN;case"null":case"NULL":return null;case"undefined":return;default:return isNaN(t)?t:+t}}(this.attr(`data-${M(t)}`));if(t&&"object"==typeof t){const e={};Object.keys(t).forEach(n=>{e[`data-${M(n)}`]=t[n]}),this.attr(e)}return this}return 2===arguments.length&&this.attr(`data-${M(t)}`,e),this}attr(t,e){if(1===arguments.length){if("string"==typeof t){if(!this[0])return;return function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(t){}return t}(this[0].getAttribute(t))}return t&&"object"==typeof t&&Object.keys(t).forEach(e=>{this[0].setAttribute(M(e),T(t[e]))}),this}return 2===arguments.length&&"string"==typeof t&&this[0].setAttribute(M(t),T(e)),this}removeAttr(t){return this.each(e=>{e.removeAttribute(t)}),this}add(t){return new b(t).each(t=>{this.filter(e=>e===t).length||(this[this.length++]=t)}),this}empty(){return this.html("")}wrap(e){if(!this.length)throw new TypeError(t);const n=new E(e);return new b(this[0].parentNode).prepend(n),n.append(this),n}addClass(t){return"string"==typeof t&&this.each(e=>{e.classList.add(...t.split(" ").filter(t=>t.trim()))}),this}removeClass(t){return"string"==typeof t&&this.each(e=>{e.classList.remove(...t.split(" ").filter(t=>t.trim()))}),this}hasClass(t){return!(!this.length||"string"!=typeof t)&&this[0].classList.contains(t)}first(){return new b(this[0])}remove(){this.each(t=>{t.parentNode.removeChild(t)})}after(t){const e=this.next().first();return e.length?e.before(t):this.append(t),this}before(t){return this.length&&new b(t).each(t=>{this[0].parentNode.insertBefore(t,this[0])}),this}next(){const t=new b;return this.each(e=>{e.nextSibling&&t.add(e.nextSibling)}),t}}class E extends b{constructor(...t){super(...t)}unwrap(){const t=new b(this[0]).after(this.children());return this.remove(),t}}function C(...t){return new b(...t)}function O(t,e){return Object.keys(e).forEach(n=>{const a=e[n];"string"==typeof t&&(t=t.replace(new RegExp(`{{${n}}}`,"g"),a))}),t}function F(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getYear()===e.getYear()}function N(){return u}function A(){return f}function L(){return g}function H(){return p}function x(){return w}function R(t){return O(m,{day:t})}function j(t){return O(D,{month:t})}function _(t,e){const n=C(O(y,{date:t}));return F(this.today,e)&&n.addClass("is-today"),this.config.rangeSelection?(this.startSelectionDate&&F(this.startSelectionDate,e)&&n.addClass("is-start-date is-in-range"),this.endSelectionDate&&F(this.endSelectionDate,e)&&n.addClass("is-end-date is-in-range"),this.startSelectionDate&&this.endSelectionDate&&function(t,e,n){const a=t.getTime();return a>e.getTime()&&a<n.getTime()}(e,this.startSelectionDate,this.endSelectionDate)&&n.addClass("is-in-range")):this.currentDate&&F(this.currentDate,e)&&n.addClass("is-current-date"),n.outerHtml()}function k(t){return t&&"object"==typeof t}function B(t,e){k(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}export default class{constructor(t={}){if(this.config=Object.freeze(function(){const t=k(arguments[0])?arguments[0]:{};for(let e=1;e<arguments.length;e++)B(arguments[e],t);return t}({target:document.body,weekStartsFrom:0,numberOfCalendars:1,rangeSelection:!1,calendarWrap:N,calendarRoot:A,calendarHeader:L,calendarBodyRoot:H,calendarFooter:x,dayElement:R,monthElement:j,dateElement:_},t)),this.config.weekStartsFrom>=7||this.config.weekStartsFrom<0)throw new Error(c);this.daysTransformed=v.slice(this.config.weekStartsFrom).concat(v.slice(0,this.config.weekStartsFrom)),this.monthsTransformed=S,this.today=new Date,this._drawCalendar()}_drawCalendar(){const t=this.config;if(this.currentTarget=C(t.target).first(),this.currentTarget.data("calendarActive"))throw new Error(e);this.calTarget=this.currentTarget,this.currentTarget.data("calendarActive",!0);const s="INPUT"===this.currentTarget[0].nodeName;if(this.config.wrapTarget||s)try{if(this.calTarget=this.currentTarget.wrap(t.calendarWrap()).addClass("calendar-wrap"),this.currentTarget.addClass(s?"calendar-input":"calendar-wrapped"),0===this.calTarget.length)throw new Error(n)}catch(t){throw new Error(t.message)}if(this.calRoot=C(t.calendarRoot()),!this.calRoot.length)throw new Error(a);if(this.calTarget.append(this.calRoot.addClass("calendar-root")),t.showHeader&&this.calRoot.append(C(t.calendarHeader()).addClass("calendar-header")),this.calBody=C(t.calendarBodyRoot()).addClass("calendar-body-root"),0===this.calBody.length)throw new Error(r);this.calRoot.append(this.calBody),t.showFooter&&this.calRoot.append(C(t.calendarFooter()).addClass("calendar-footer")),this._drawMonths()}_drawMonths(t){this.calBody.empty();const e=t||new Date;e.setDate(1),this.startMonthDate=e;let n=0;for(;n<this.config.numberOfCalendars;){const t=C('<div class="calendar-month"></div>');try{t.append(this.config.monthElement(this.monthsTransformed[e.getMonth()],e))}catch(t){throw new Error(i)}try{t.append(`<div class="calendar-days-wrap">${this.daysTransformed.map(this.config.dayElement).join("")}</div>`)}catch(t){throw new Error(s)}const a=C('<div class="calendar-dates-wrap"></div>');t.append(a),this.calBody.append(t),this._drawDates(a,e),n+=1,e.setDate(1),e.setMonth(e.getMonth()+1)}}_drawDates(t,e){const n=function(t,e){const n=new Date;return n.setFullYear(e),n.setMonth(t),n.setDate(31),31===n.getDate()?31:(n.setDate(31-n.getDate()),n.getDate())}(e.getMonth(),e.getFullYear());let a=e.getDay()-v.indexOf(this.daysTransformed[0]);a<0&&(a=7-Math.abs(a));try{for(let n=0;n<a;n++){const r=e.getDate()-a+n,s=new Date(e.getFullYear(),e.getMonth(),r);t.append(C(this.config.dateElement.apply(this,[s.getDate(),s])).addClass("calendar-date-prev"))}for(let a=1;a<=n;a++)e.setDate(a),t.append(this.config.dateElement.apply(this,[a,e]));let r=v.indexOf(this.daysTransformed[6])-e.getDay();r<0&&(r=7-Math.abs(r));for(let n=0;n<r;n++){const a=e.getDate()+n+1,r=new Date(e.getFullYear(),e.getMonth(),a);t.append(C(this.config.dateElement.apply(this,[r.getDate(),r])).addClass("calendar-date-next"))}}catch(t){throw new Error(o)}}destroy(){return this.currentTarget.removeClass("calendar-input calendar-wrapped").removeAttr("data-calendar-active"),this.calTarget.unwrap&&this.calTarget.unwrap(),this.calRoot.remove(),this}next(t=1){const e=+this.config.numberOfCalendars;return this.startMonthDate.setMonth(this.startMonthDate.getMonth()-e+t),this._drawMonths(this.startMonthDate),this}prev(t=1){const e=+this.config.numberOfCalendars;return this.startMonthDate.setMonth(this.startMonthDate.getMonth()-e-t),this._drawMonths(this.startMonthDate),this}setDate(t){if(this.config.rangeSelection)throw new Error(d);return this.currentDate=t instanceof Date?t:new Date(...arguments),this._drawMonths(new Date(this.currentDate.valueOf())),this}getDate(){if(this.config.rangeSelection)throw new Error(d);return new Date((this.currentDate||this.today).valueOf())}getToday(){return new Date(this.today.valueOf())}setStartDate(t){if(!this.config.rangeSelection)throw new Error(h);return this.startSelectionDate=t instanceof Date?new Date(t.valueOf()):new Date(...arguments),this.endSelectionDate=new Date(this.startSelectionDate.valueOf()),this}setEndDate(t){if(!this.config.rangeSelection)throw new Error(h);if(this.endSelectionDate=t instanceof Date?new Date(t.valueOf()):new Date(...arguments),this.startSelectionDate||(this.startSelectionDate=new Date(this.endSelectionDate.valueOf())),this.startSelectionDate&&this.endSelectionDate.getTime()<this.startSelectionDate.getTime()){console.warn(l);const t=new Date(this.startSelectionDate.valueOf());this.startSelectionDate=this.endSelectionDate,this.endSelectionDate=t}return this}getStartDate(){if(!this.config.rangeSelection)throw new Error(h);return new Date((this.startSelectionDate||this.today).valueOf())}getEndDate(){if(!this.config.rangeSelection)throw new Error(h);return new Date((this.endSelectionDate||this.today).valueOf())}jumpTo(t){return this._drawMonths(t instanceof Date?new Date(t.valueOf()):new Date(...arguments)),this}}
